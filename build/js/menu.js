const synth=window.speechSynthesis,voiceSelect=document.querySelector("select"),menuForm=document.getElementById("menuForm");let reader=null;const options={contentDivElem:"#content  ",nextPageBtn:".nextchap",timer:20,lastParagraf:0,timerCheckbox:!0,timeout:2e3,utterThis:{language:null,pitch:2,rate:2,volume:1}},getTimeFormat=(e,t)=>{var e=(new Date).getTime()+6e4*e;let o=new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});reader&&(e=new Date(reader),o=(o+="  save time: ")+e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),t.timerValue.value=o};function populateVoiceList(){var t=synth.getVoices().sort(function(e,t){e=e.lang.toUpperCase(),t=t.lang.toUpperCase();return e<t?-1:e==t?0:1});let o=0;voiceSelect.innerHTML="";for(let e=0;e<t.length;e++){var n=document.createElement("option");n.textContent=`(${t[e].lang}) ${t[e].name} `,t[e].default&&(n.textContent+=" -- DEFAULT"),n.setAttribute("data-lang",t[e].lang),n.setAttribute("data-name",t[e].name),voiceSelect.appendChild(n),t[e].name===options.utterThis.language&&(o=e)}voiceSelect.selectedIndex=o}async function loadDataFromStorage(){try{var e=await chrome.storage.sync.get(["options","reader"]);reader=e.reader,e.options&&(Object.assign(options,e.options),e.options.utterThis)&&Object.assign(options.utterThis,e.options.utterThis),setFormValues(options),updateTimerState(options.timerCheckbox),updateDisplayedValues(),getTimeFormat(options.timer,menuForm),console.log({options:options,reader:reader})}catch(e){console.error("Error loading data from storage:",e)}}function setFormValues(e){menuForm.volume.value=e.utterThis.volume,menuForm.rate.value=e.utterThis.rate,menuForm.pitch.value=e.utterThis.pitch,menuForm.timer.value=e.timer,menuForm.timerCheckbox.checked=e.timerCheckbox}function updateTimerState(e){menuForm.timer.disabled=!e}function updateOptionsFromForm(){options.utterThis.volume=Number(menuForm.volume.value),options.utterThis.rate=Number(menuForm.rate.value),options.utterThis.pitch=Number(menuForm.pitch.value),options.timer=Number(menuForm.timer.value),options.timerCheckbox=menuForm.timerCheckbox.checked,options.utterThis.language=voiceSelect.selectedOptions[0].getAttribute("data-name")}function updateDisplayedValues(){menuForm.rateValue.value=Number(menuForm.rate.value),menuForm.pitchValue.value=Number(menuForm.pitch.value),menuForm.volumeValue.value=Math.floor(100*Number(menuForm.volume.value))+"%"}loadDataFromStorage().then(()=>populateVoiceList()),void 0!==speechSynthesis.onvoiceschanged&&(speechSynthesis.onvoiceschanged=populateVoiceList),menuForm.addEventListener("change",()=>{updateOptionsFromForm(),updateTimerState(options.timerCheckbox),getTimeFormat(options.timer,menuForm),console.log(options),chrome.storage.sync.set({options:options})}),menuForm.addEventListener("input",()=>{updateDisplayedValues()});